# Top-3 ê·œì¹™ ê²€ì¦ ë° ì„¤ëª… ê°œì„ 

## ë¬¸ì œì 

### ê¸°ì¡´ ë¬¸ì œ
```
ì‚¬ìš©ì ê·œì¹™: "PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬"

LLM ì„ ì • ê²°ê³¼:
1. task_cd64a452be99: PN + ì„í˜¸ê·œ + task âŒ
2. deadline_34a565fd48a0: PN + ì„í˜¸ê·œ + deadline âŒ
3. task_1470971bb893: PO + ì „í˜•ìš° + task âŒ

ë¬¸ì œ:
- í”„ë¡œì íŠ¸ ì¡°ê±´ ìœ„ë°˜ (PO â‰  PN)
- ìš”ì²­ì ì¡°ê±´ ìœ„ë°˜ (ì„í˜¸ê·œ â‰  ì „í˜•ìš°)
- ìœ í˜• ì¡°ê±´ ìœ„ë°˜ (deadline â‰  task)
- í†µì¼ì„± ì—†ìŒ (ê°ê° ë‹¤ë¥¸ ì¡°ê±´ ìœ„ë°˜)
- ì„¤ëª… ë¶ˆì¶©ë¶„ (ì™œ ì´ë ‡ê²Œ ì„ ì •í–ˆëŠ”ì§€ ë¶ˆëª…í™•)
```

---

## ê°œì„  ì‚¬í•­

### 1. í”„ë¡¬í”„íŠ¸ ê°•í™”

#### í†µì¼ì„± ì›ì¹™ ì¶”ê°€
```
**í†µì¼ì„± ì›ì¹™**: ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì¡°ê±´ì„ ì™„í™”í•˜ì„¸ìš”

ì˜ˆì‹œ 1 (ì˜¬ë°”ë¦„ âœ…):
- ì™„ë²½ ì¼ì¹˜: PN + ì „í˜•ìš° + task (1ê°œ)
- ìš”ì²­ì ì™„í™”: PN + ì„í˜¸ê·œ + task (2ê°œ)
â†’ í”„ë¡œì íŠ¸ì™€ ìœ í˜•ì€ í†µì¼

ì˜ˆì‹œ 2 (ì˜ëª»ë¨ âŒ):
- PN + ì„í˜¸ê·œ + task (1ê°œ)
- PN + ì„í˜¸ê·œ + deadline (1ê°œ)
- PO + ì „í˜•ìš° + task (1ê°œ)
â†’ ê°ê° ë‹¤ë¥¸ ì¡°ê±´ ìœ„ë°˜, í†µì¼ì„± ì—†ìŒ
```

#### ì¡°ê±´ ì™„í™” ìš°ì„ ìˆœìœ„ ëª…í™•í™”
```
1. ìœ í˜• ì¡°ê±´: ì ˆëŒ€ ì™„í™” ê¸ˆì§€ â›”
2. ìˆ˜ì‹ ë°©ë²• ì¡°ê±´: ì ˆëŒ€ ì™„í™” ê¸ˆì§€ â›”
3. ìš”ì²­ì ì¡°ê±´: ìš°ì„  ì™„í™” (ê°™ì€ í”„ë¡œì íŠ¸ ìœ ì§€)
4. í”„ë¡œì íŠ¸ ì¡°ê±´: ë§ˆì§€ë§‰ ì™„í™” (ê°™ì€ ìš”ì²­ì ìœ ì§€)
```

### 2. ê²€ì¦ ë¡œì§ ì¶”ê°€

#### ì„ ì • ê²°ê³¼ ìë™ ê²€ì¦
```python
def _validate_and_explain_selection(
    selected_ids, todos, natural_rule, original_reasoning
):
    """ì„ ì • ê²°ê³¼ ê²€ì¦ ë° ì„¤ëª… ê°œì„ """
    
    # 1. ê·œì¹™ì—ì„œ ì¡°ê±´ ì¶”ì¶œ
    expected_project = "PN"
    expected_requester = "ì „í˜•ìš°"
    expected_type = "task"
    
    # 2. ì„ ì •ëœ TODO ë¶„ì„
    for todo in selected_todos:
        issues = []
        
        if todo.project != expected_project:
            issues.append("í”„ë¡œì íŠ¸ ë¶ˆì¼ì¹˜")
        
        if todo.requester != expected_requester:
            issues.append("ìš”ì²­ì ë¶ˆì¼ì¹˜")
        
        if todo.type != expected_type:
            issues.append("ìœ í˜• ë¶ˆì¼ì¹˜")
        
        if issues:
            violations.append(todo, issues)
    
    # 3. ì„¤ëª… ê°œì„ 
    if violations:
        return enhanced_explanation
```

#### ê°œì„ ëœ ì„¤ëª… í˜•ì‹
```
ì›ë³¸ LLM ì„¤ëª…

âš ï¸ ì„ ì • ê²°ê³¼ ë¶„ì„:

âœ… ì™„ë²½íˆ ì¼ì¹˜: 1ê°œ
  - task_abc123: í”„ë¡œì íŠ¸=PN, ìš”ì²­ì=ì „í˜•ìš°, ìœ í˜•=task

âš ï¸ ë¶€ë¶„ ì¼ì¹˜: 2ê°œ
  - task_cd64a452be99: í”„ë¡œì íŠ¸=PN, ìš”ì²­ì=ì„í˜¸ê·œ, ìœ í˜•=task
    â†’ ìš”ì²­ì ë¶ˆì¼ì¹˜ (ê¸°ëŒ€: ì „í˜•ìš°, ì‹¤ì œ: ì„í˜¸ê·œ)
  
  - deadline_34a565fd48a0: í”„ë¡œì íŠ¸=PN, ìš”ì²­ì=ì„í˜¸ê·œ, ìœ í˜•=deadline
    â†’ ìš”ì²­ì ë¶ˆì¼ì¹˜ (ê¸°ëŒ€: ì „í˜•ìš°, ì‹¤ì œ: ì„í˜¸ê·œ)
    â†’ ìœ í˜• ë¶ˆì¼ì¹˜ (ê¸°ëŒ€: task, ì‹¤ì œ: deadline)

ğŸ“ ì¡°ê±´ ì™„í™”: ê·œì¹™ì„ ì™„ë²½íˆ ë§Œì¡±í•˜ëŠ” TODOê°€ 1ê°œë¿ì´ì–´ì„œ, 
ë¶€ë¶„ì ìœ¼ë¡œ ì¼ì¹˜í•˜ëŠ” TODO 2ê°œë¥¼ ì¶”ê°€ë¡œ ì„ ì •í–ˆìŠµë‹ˆë‹¤.
```

---

## ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì™„ë²½í•œ ì„ ì • âœ…

**ê·œì¹™**: "PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬"

**ì„ ì • ê²°ê³¼**:
```
1. task_abc123: PN + ì „í˜•ìš° + task âœ…
2. task_def456: PN + ì „í˜•ìš° + task âœ…
3. task_ghi789: PN + ì „í˜•ìš° + task âœ…

ì„¤ëª…:
"PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬ TODOë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤. 
ì¡°ê±´ì„ ì™„ë²½íˆ ë§Œì¡±í•˜ëŠ” TODO 3ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤."
```

### ì˜ˆì‹œ 2: ìš”ì²­ì ì¡°ê±´ ì™„í™” (í†µì¼ì„± ìœ ì§€) âœ…

**ê·œì¹™**: "PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬"

**ì„ ì • ê²°ê³¼**:
```
1. task_abc123: PN + ì „í˜•ìš° + task âœ… (ì™„ë²½ ì¼ì¹˜)
2. task_def456: PN + ì„í˜¸ê·œ + task âš ï¸ (ìš”ì²­ìë§Œ ë‹¤ë¦„)
3. task_ghi789: PN + ì„í˜¸ê·œ + task âš ï¸ (ìš”ì²­ìë§Œ ë‹¤ë¦„)

ì„¤ëª…:
"PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬ TODO 1ê°œë¥¼ ì„ ì •í•˜ê³ , 
PN í”„ë¡œì íŠ¸ì˜ ë‹¤ë¥¸ ìš”ì²­ì(ì„í˜¸ê·œ)ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬ TODO 2ê°œë¥¼ 
ì¶”ê°€ë¡œ ì„ ì •í–ˆìŠµë‹ˆë‹¤. (ìš”ì²­ì ì¡°ê±´ë§Œ ì™„í™”, í”„ë¡œì íŠ¸ì™€ ìœ í˜•ì€ í†µì¼)"

âš ï¸ ì„ ì • ê²°ê³¼ ë¶„ì„:
âœ… ì™„ë²½íˆ ì¼ì¹˜: 1ê°œ
âš ï¸ ë¶€ë¶„ ì¼ì¹˜: 2ê°œ (ìš”ì²­ì ë¶ˆì¼ì¹˜)
ğŸ“ ì¡°ê±´ ì™„í™”: ê·œì¹™ì„ ì™„ë²½íˆ ë§Œì¡±í•˜ëŠ” TODOê°€ 1ê°œë¿ì´ì–´ì„œ...
```

### ì˜ˆì‹œ 3: í”„ë¡œì íŠ¸ ì¡°ê±´ ì™„í™” (í†µì¼ì„± ìœ ì§€) âœ…

**ê·œì¹™**: "PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬"

**ì„ ì • ê²°ê³¼**:
```
1. task_abc123: PO + ì „í˜•ìš° + task âš ï¸ (í”„ë¡œì íŠ¸ë§Œ ë‹¤ë¦„)
2. task_def456: PO + ì „í˜•ìš° + task âš ï¸ (í”„ë¡œì íŠ¸ë§Œ ë‹¤ë¦„)
3. task_ghi789: PO + ì „í˜•ìš° + task âš ï¸ (í”„ë¡œì íŠ¸ë§Œ ë‹¤ë¦„)

ì„¤ëª…:
"PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬ TODOë¥¼ ì°¾ì•˜ìœ¼ë‚˜ ì—†ì–´ì„œ, 
ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬ TODO 3ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤. 
(í”„ë¡œì íŠ¸ ì¡°ê±´ ì™„í™”, ìš”ì²­ìì™€ ìœ í˜•ì€ í†µì¼)"

âš ï¸ ì„ ì • ê²°ê³¼ ë¶„ì„:
âš ï¸ ë¶€ë¶„ ì¼ì¹˜: 3ê°œ (í”„ë¡œì íŠ¸ ë¶ˆì¼ì¹˜)
ğŸ“ ì¡°ê±´ ì™„í™”: ê·œì¹™ì„ ì™„ë²½íˆ ë§Œì¡±í•˜ëŠ” TODOê°€ ì—†ì–´ì„œ...
```

### ì˜ˆì‹œ 4: ì˜ëª»ëœ ì„ ì • (í†µì¼ì„± ì—†ìŒ) âŒ

**ê·œì¹™**: "PN í”„ë¡œì íŠ¸ì˜ ì „í˜•ìš°ê°€ ìš”ì²­í•œ ì—…ë¬´ì²˜ë¦¬"

**ì˜ëª»ëœ ì„ ì •**:
```
1. task_abc123: PN + ì„í˜¸ê·œ + task âŒ
2. deadline_def456: PN + ì„í˜¸ê·œ + deadline âŒ
3. task_ghi789: PO + ì „í˜•ìš° + task âŒ

ë¬¸ì œ:
- ê°ê° ë‹¤ë¥¸ ì¡°ê±´ ìœ„ë°˜
- í†µì¼ì„± ì—†ìŒ
- ìœ í˜• ì¡°ê±´ ìœ„ë°˜ (deadline)
```

**ì˜¬ë°”ë¥¸ ì„ ì •**:
```
1. task_abc123: PN + ì„í˜¸ê·œ + task âœ…
2. task_def456: PN + ì„í˜¸ê·œ + task âœ…
3. task_ghi789: PN + ì„í˜¸ê·œ + task âœ…

â†’ ìš”ì²­ì ì¡°ê±´ë§Œ í†µì¼ì„± ìˆê²Œ ì™„í™”
â†’ í”„ë¡œì íŠ¸ì™€ ìœ í˜•ì€ ëª¨ë‘ ë™ì¼
```

---

## ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### LLM ì„ ì • í›„ ìë™ ê²€ì¦

```
âœ… 1. ê°œìˆ˜ í™•ì¸
   - ì •í™•íˆ 3ê°œ ì„ ì •ë˜ì—ˆëŠ”ê°€?

âœ… 2. ìœ í˜• í†µì¼ì„±
   - ëª¨ë“  TODOê°€ ê°™ì€ ìœ í˜•ì¸ê°€?
   - ìœ í˜• ì¡°ê±´ì´ ìˆìœ¼ë©´ ì ˆëŒ€ ìœ„ë°˜ ê¸ˆì§€

âœ… 3. ìˆ˜ì‹ ë°©ë²• í†µì¼ì„±
   - ëª¨ë“  TODOê°€ ê°™ì€ ìˆ˜ì‹ ë°©ë²•ì¸ê°€?
   - ìˆ˜ì‹ ë°©ë²• ì¡°ê±´ì´ ìˆìœ¼ë©´ ì ˆëŒ€ ìœ„ë°˜ ê¸ˆì§€

âœ… 4. ì¡°ê±´ ì™„í™” í†µì¼ì„±
   - ìš”ì²­ìë§Œ ë‹¤ë¥´ë©´: í”„ë¡œì íŠ¸ì™€ ìœ í˜•ì€ ë™ì¼í•´ì•¼ í•¨
   - í”„ë¡œì íŠ¸ë§Œ ë‹¤ë¥´ë©´: ìš”ì²­ìì™€ ìœ í˜•ì€ ë™ì¼í•´ì•¼ í•¨

âœ… 5. ì„¤ëª… ëª…í™•ì„±
   - ì–´ë–¤ ì¡°ê±´ì„ ì™„í™”í–ˆëŠ”ì§€ ëª…ì‹œ
   - ê° TODOì˜ ì‹¤ì œ ê°’ í‘œì‹œ
   - ë¶ˆì¼ì¹˜ í•­ëª© ëª…í™•íˆ í‘œì‹œ
```

---

## ì½”ë“œ ë³€ê²½ ì‚¬í•­

### 1. í”„ë¡¬í”„íŠ¸ ê°œì„ 
```python
# offline_agent/src/services/top3_llm_selector.py

# í†µì¼ì„± ì›ì¹™ ì¶”ê°€
"**í†µì¼ì„± ì›ì¹™**: ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì¡°ê±´ì„ ì™„í™”í•˜ì„¸ìš”"

# ì¡°ê±´ ì™„í™” ìš°ì„ ìˆœìœ„ ëª…í™•í™”
"1. ìœ í˜• ì¡°ê±´: ì ˆëŒ€ ì™„í™” ê¸ˆì§€"
"2. ìˆ˜ì‹ ë°©ë²• ì¡°ê±´: ì ˆëŒ€ ì™„í™” ê¸ˆì§€"
"3. ìš”ì²­ì ì¡°ê±´: ìš°ì„  ì™„í™”"
"4. í”„ë¡œì íŠ¸ ì¡°ê±´: ë§ˆì§€ë§‰ ì™„í™”"
```

### 2. ê²€ì¦ ë¡œì§ ì¶”ê°€
```python
def _validate_and_explain_selection(
    self,
    selected_ids: Set[str],
    todos: List[Dict],
    natural_rule: str,
    original_reasoning: str
) -> str:
    """ì„ ì • ê²°ê³¼ ê²€ì¦ ë° ì„¤ëª… ê°œì„ """
    
    # ê·œì¹™ì—ì„œ ì¡°ê±´ ì¶”ì¶œ
    expected_project = ...
    expected_requester = ...
    expected_type = ...
    
    # ì„ ì •ëœ TODO ë¶„ì„
    violations = []
    perfect_matches = []
    
    for todo in selected_todos:
        issues = []
        
        if project != expected_project:
            issues.append("í”„ë¡œì íŠ¸ ë¶ˆì¼ì¹˜")
        
        if requester != expected_requester:
            issues.append("ìš”ì²­ì ë¶ˆì¼ì¹˜")
        
        if type != expected_type:
            issues.append("ìœ í˜• ë¶ˆì¼ì¹˜")
        
        if issues:
            violations.append(...)
        else:
            perfect_matches.append(...)
    
    # ì„¤ëª… ê°œì„ 
    if violations:
        return enhanced_explanation
    
    return original_reasoning
```

---

## ê¸°ëŒ€ íš¨ê³¼

### 1. ì •í™•ì„± í–¥ìƒ
- ê·œì¹™ ì¤€ìˆ˜ìœ¨ ì¦ê°€
- ì¡°ê±´ ìœ„ë°˜ ìµœì†Œí™”

### 2. íˆ¬ëª…ì„± í–¥ìƒ
- ì„ ì • ì´ìœ  ëª…í™•í™”
- ì¡°ê±´ ì™„í™” ë‚´ì—­ í‘œì‹œ

### 3. ì¼ê´€ì„± í–¥ìƒ
- í†µì¼ì„± ìˆëŠ” ì„ ì •
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ê²°ê³¼

### 4. ì‚¬ìš©ì ì‹ ë¢° í–¥ìƒ
- ëª…í™•í•œ ì„¤ëª…
- ê²€ì¦ ê°€ëŠ¥í•œ ê²°ê³¼
