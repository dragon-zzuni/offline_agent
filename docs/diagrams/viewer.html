<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Assistant - ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ë·°ì–´</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontSize: '16px',
                fontFamily: 'Malgun Gothic, Arial, sans-serif'
            }
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #4A90E2;
        }
        
        .tab.active {
            color: #4A90E2;
            border-bottom-color: #4A90E2;
            font-weight: bold;
        }
        
        .diagram-container {
            display: none;
            padding: 20px;
            background: #fafafa;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        .diagram-container.active {
            display: block;
        }
        
        .diagram-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .diagram-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 4px;
            display: flex;
            justify-content: center;
        }
        
        .download-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .download-btn:hover {
            background: #357ABD;
        }
        
        .info-box {
            background: #E3F2FD;
            border-left: 4px solid #4A90E2;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #4A90E2;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ Smart Assistant - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h1>
        <p class="subtitle">PMì„ ìœ„í•œ AI ê¸°ë°˜ ì—…ë¬´ ìë™í™” ë„êµ¬</p>
        
        <div class="tabs">
            <button class="tab active" onclick="showDiagram('core')">í•µì‹¬ ê¸°ëŠ¥</button>
            <button class="tab" onclick="showDiagram('system')">ì „ì²´ êµ¬ì¡°</button>
            <button class="tab" onclick="showDiagram('layer')">ë ˆì´ì–´ êµ¬ì¡°</button>
            <button class="tab" onclick="showDiagram('detailed')">ìƒì„¸ êµ¬ì¡°</button>
            <button class="tab" onclick="showDiagram('dataflow')">ë°ì´í„° í”Œë¡œìš°</button>
        </div>
        
        <!-- í•µì‹¬ ê¸°ëŠ¥ ì•„í‚¤í…ì²˜ -->
        <div id="core" class="diagram-container active">
            <div class="diagram-title">ğŸ¯ í•µì‹¬ ê¸°ëŠ¥ ì•„í‚¤í…ì²˜</div>
            <div class="diagram-description">
                Smart Assistantì˜ 6ëŒ€ í•µì‹¬ ê¸°ëŠ¥ê³¼ ê° ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ê´€ê³„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
                <br><br>
                <strong>6ëŒ€ í•µì‹¬ ê¸°ëŠ¥:</strong><br>
                1ï¸âƒ£ REST API í†µí•œ ì‹¤ì‹œê°„ ì—°ë™<br>
                2ï¸âƒ£ ë©”ì‹œì§€/ë©”ì¼ í†µí•© ë¶„ì„ ë° TODO ë¦¬ìŠ¤íŠ¸ ì •ë¦¬<br>
                3ï¸âƒ£ Top3 TODO ì‚¬ìš©ì ë§ì¶¤ í•„í„°ë§ (ìì—°ì–´ ê·œì¹™ ì ìš©)<br>
                4ï¸âƒ£ ë©”ì‹œì§€ ë‚´ì—­ (ì¼ì¼/ì£¼ê°„/ì›”ë³„ ìš”ì•½)<br>
                5ï¸âƒ£ ì¼ì • ë§ˆë¬´ë¦¬ ì‹œìŠ¤í…œ (ì¼ì¼ìš”ì•½, ì£¼ê°„ìš”ì•½, ë‚ ì”¨)
            </div>
            <div class="mermaid">
graph LR
    subgraph F1["1ï¸âƒ£ REST API ì‹¤ì‹œê°„ ì—°ë™"]
        VDOS[VirtualOffice API]
        PW[Polling Worker<br/>30ì´ˆ ê°„ê²©]
        VOS[ì¦ë¶„ ìˆ˜ì§‘<br/>since_id]
        
        VDOS --> VOS
        PW --> VOS
    end
    
    subgraph F2["2ï¸âƒ£ ë©”ì‹œì§€/ë©”ì¼ í†µí•© ë¶„ì„"]
        AP[Analysis Pipeline]
        NLP[NLP ëª¨ë“ˆ<br/>ìš”ì•½/ì¶”ì¶œ/ìš°ì„ ìˆœìœ„]
        LLM1[LLM<br/>GPT-4o]
        
        AP --> NLP
        NLP --> LLM1
    end
    
    subgraph F3["3ï¸âƒ£ TODO ë¦¬ìŠ¤íŠ¸ ì •ë¦¬"]
        TR[Todo Repository]
        PTS[Project Tag<br/>ìë™ ë¶„ë¥˜]
        DB1[(SQLite)]
        
        TR --> PTS
        PTS --> DB1
    end
    
    subgraph F4["4ï¸âƒ£ Top3 ë§ì¶¤ í•„í„°ë§"]
        T3S[Top3 Service]
        T3LS[LLM Selector<br/>ìì—°ì–´ ê·œì¹™]
        LLM2[LLM RAG]
        CACHE[(Cache<br/>TTL 5ë¶„)]
        
        T3S --> T3LS
        T3LS --> LLM2
        T3LS --> CACHE
    end
    
    subgraph F5["5ï¸âƒ£ ë©”ì‹œì§€ ë‚´ì—­ ìš”ì•½"]
        TRS[Time Range<br/>ì¼ì¼/ì£¼ê°„/ì›”ë³„]
        MG[Message Grouping<br/>ì‹œê°„ëŒ€ë³„]
        SUM[LLM ìš”ì•½]
        
        TRS --> MG
        MG --> SUM
    end
    
    subgraph F6["6ï¸âƒ£ ì¼ì • ë§ˆë¬´ë¦¬ ì‹œìŠ¤í…œ"]
        SD[Summary Dialog]
        DS[ì¼ì¼/ì£¼ê°„ ìš”ì•½]
        WS[ë‚ ì”¨ ì •ë³´]
        
        SD --> DS
        SD --> WS
    end
    
    VOS --> AP
    AP --> TR
    TR --> T3S
    MG --> SUM
    DS --> SUM
    
    style F1 fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style F2 fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style F3 fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style F4 fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    style F5 fill:#FFF9C4,stroke:#F9A825,stroke-width:2px
    style F6 fill:#FFE0B2,stroke:#E64A19,stroke-width:2px
            </div>
            <div class="info-box">
                <h3>ğŸ’¡ í•µì‹¬ ê¸°ëŠ¥ ì„¤ëª…</h3>
                <p>
                    <strong>1ï¸âƒ£ REST API ì‹¤ì‹œê°„ ì—°ë™</strong>: 30ì´ˆ ê°„ê²©ìœ¼ë¡œ VirtualOffice APIë¥¼ í´ë§í•˜ì—¬ ì‹ ê·œ ë©”ì‹œì§€ ìë™ ìˆ˜ì§‘<br>
                    <strong>2ï¸âƒ£ ë©”ì‹œì§€/ë©”ì¼ í†µí•© ë¶„ì„</strong>: LLM ê¸°ë°˜ NLPë¡œ ë©”ì‹œì§€ ìš”ì•½, TODO ì¶”ì¶œ, ìš°ì„ ìˆœìœ„ ê³„ì‚°<br>
                    <strong>3ï¸âƒ£ TODO ë¦¬ìŠ¤íŠ¸ ì •ë¦¬</strong>: í”„ë¡œì íŠ¸ ìë™ ë¶„ë¥˜ (ëª…ì‹œì  íŒ¨í„´ â†’ LLM ë¶„ì„ â†’ ë°œì‹ ì í´ë°±)<br>
                    <strong>4ï¸âƒ£ Top3 ë§ì¶¤ í•„í„°ë§</strong>: ìì—°ì–´ ê·œì¹™ìœ¼ë¡œ ê°€ì¥ ì¤‘ìš”í•œ TODO 3ê°œ ì„ ì • (LLM RAG ë°©ì‹)<br>
                    <strong>5ï¸âƒ£ ë©”ì‹œì§€ ë‚´ì—­ ìš”ì•½</strong>: ì‹œê°„ëŒ€ë³„/ë°œì‹ ìë³„ ê·¸ë£¹í™” ë° ìš”ì•½ (ì¼ì¼/ì£¼ê°„/ì›”ë³„)<br>
                    <strong>6ï¸âƒ£ ì¼ì • ë§ˆë¬´ë¦¬ ì‹œìŠ¤í…œ</strong>: ì¼ì¼/ì£¼ê°„ ì—…ë¬´ ìš”ì•½ + ë‚ ì”¨ ì •ë³´ ì œê³µ
                </p>
            </div>
        </div>
        
        <!-- ì „ì²´ êµ¬ì¡° -->
        <div id="system" class="diagram-container">
            <div class="diagram-title">1. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°</div>
            <div class="diagram-description">
                Smart Assistantì˜ ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. 
                GUI, ë°ì´í„° ì†ŒìŠ¤, ë¶„ì„ íŒŒì´í”„ë¼ì¸, LLM ì„œë¹„ìŠ¤, ìºì‹œ ì‹œìŠ¤í…œ ê°„ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
            </div>
            <div class="mermaid">
graph TB
    GUI[Smart Assistant GUI<br/>PyQt6 Desktop]
    
    JSON[JSON Dataset<br/>Offline]
    VDOS[VirtualOffice<br/>REST API]
    
    DSM[Data Sources Manager]
    AP[Analysis Pipeline]
    LLM[LLM Services<br/>GPT-4o/Azure/OpenRouter]
    CACHE[(SQLite Cache<br/>todos_cache.db)]
    
    GUI --> JSON
    GUI --> VDOS
    JSON --> DSM
    VDOS --> DSM
    DSM --> AP
    AP --> LLM
    LLM --> CACHE
    CACHE --> GUI
    
    style GUI fill:#4A90E2,color:#fff
    style LLM fill:#E94B3C,color:#fff
    style CACHE fill:#50C878,color:#fff
            </div>
            <div class="info-box">
                <h3>ğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸</h3>
                <p>
                    â€¢ GUIëŠ” JSON(ì˜¤í”„ë¼ì¸)ê³¼ VirtualOffice(ì‹¤ì‹œê°„) ë‘ ê°€ì§€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.<br>
                    â€¢ ëª¨ë“  ë¶„ì„ì€ LLM(GPT-4o)ì„ í†µí•´ ìˆ˜í–‰ë˜ë©°, ê²°ê³¼ëŠ” SQLiteì— ìºì‹œë©ë‹ˆë‹¤.<br>
                    â€¢ ìºì‹œ ì‹œìŠ¤í…œìœ¼ë¡œ API í˜¸ì¶œì„ ìµœì†Œí™”í•˜ì—¬ ë¹„ìš©ì„ ì ˆê°í•©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
        
        <!-- ë ˆì´ì–´ êµ¬ì¡° -->
        <div id="layer" class="diagram-container">
            <div class="diagram-title">2. ë ˆì´ì–´ êµ¬ì¡°</div>
            <div class="diagram-description">
                4ê³„ì¸µ ì•„í‚¤í…ì²˜: Presentation(UI) â†’ Business Logic â†’ Data Access â†’ Infrastructure
            </div>
            <div class="mermaid">
graph TB
    subgraph Presentation["Presentation Layer (UI)"]
        MW[Main Window]
        TP[Todo Panel]
        AP[Analysis Panel]
        SD[Simulation Dashboard]
    end
    
    subgraph Business["Business Logic Layer"]
        TC[Todo Controller]
        T3S[Top3 Service]
        PTS[Project Tag Service]
        APS[Analysis Pipeline]
        VOC[VirtualOffice Coordinator]
    end
    
    subgraph Data["Data Access Layer"]
        JSON[JSON Source]
        VDOS[VirtualOffice Source]
        TR[Todo Repository]
        LLMC[LLM Client]
    end
    
    subgraph Infrastructure["Infrastructure Layer"]
        DB[(SQLite)]
        FS[File System]
        API[External APIs]
    end
    
    MW --> TC
    TP --> T3S
    AP --> APS
    SD --> VOC
    
    TC --> TR
    T3S --> LLMC
    PTS --> LLMC
    APS --> LLMC
    VOC --> VDOS
    
    TR --> DB
    JSON --> FS
    VDOS --> API
    LLMC --> API
    
    style Presentation fill:#E3F2FD
    style Business fill:#FFF3E0
    style Data fill:#F3E5F5
    style Infrastructure fill:#E8F5E9
            </div>
            <div class="info-box">
                <h3>ğŸ’¡ ë ˆì´ì–´ë³„ ì±…ì„</h3>
                <p>
                    â€¢ <strong>Presentation</strong>: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤, ì´ë²¤íŠ¸ ì²˜ë¦¬<br>
                    â€¢ <strong>Business Logic</strong>: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™, ì›Œí¬í”Œë¡œìš° ì¡°ì •<br>
                    â€¢ <strong>Data Access</strong>: ë°ì´í„° ì†ŒìŠ¤ ì¶”ìƒí™”, CRUD ì‘ì—…<br>
                    â€¢ <strong>Infrastructure</strong>: ì™¸ë¶€ ì‹œìŠ¤í…œ, ì €ì¥ì†Œ, API ì—°ë™
                </p>
            </div>
        </div>
        
        <!-- ìƒì„¸ êµ¬ì¡° -->
        <div id="detailed" class="diagram-container">
            <div class="diagram-title">3. offline_agent ìƒì„¸ êµ¬ì¡°</div>
            <div class="diagram-description">
                ëª¨ë“  ì£¼ìš” ì»´í¬ë„ŒíŠ¸ì™€ íŒŒì¼ êµ¬ì¡°ë¥¼ ìƒì„¸í•˜ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤. 
                UI, Controllers, Services, NLP, Data Sources, Integration ë ˆì´ì–´ í¬í•¨.
            </div>
            <div class="mermaid">
graph TB
    subgraph UI["UI Layer"]
        MW[MainWindow<br/>2,382 lines]
        TP[TodoPanel]
        ARP[AnalysisResultPanel]
    end
    
    subgraph Services["Services"]
        T3S[Top3Service]
        PTS[ProjectTagService]
        APS[AnalysisPipeline]
        LLMC[LLMClient]
    end
    
    subgraph NLP["NLP"]
        SUM[Summarizer]
        PR[PriorityRanker]
        AE[ActionExtractor]
    end
    
    subgraph DataSources["Data Sources"]
        DSM[Manager]
        JSONS[JSON]
        VDOSS[VirtualOffice]
    end
    
    subgraph DB["Database"]
        TODODB[(todos_cache.db)]
        PTDB[(project_tags.db)]
        T3DB[(top3_cache.db)]
    end
    
    MW --> TP
    TP --> T3S
    T3S --> LLMC
    
    APS --> SUM
    APS --> PR
    APS --> AE
    APS --> LLMC
    
    PTS --> LLMC
    PTS --> PTDB
    
    DSM --> JSONS
    DSM --> VDOSS
    
    T3S --> T3DB
    LLMC --> TODODB
    
    style UI fill:#E3F2FD
    style Services fill:#FFF3E0
    style NLP fill:#F3E5F5
    style DataSources fill:#E8F5E9
    style DB fill:#FFE0B2
            </div>
            <div class="info-box">
                <h3>ğŸ’¡ ì£¼ìš” ì»´í¬ë„ŒíŠ¸</h3>
                <p>
                    â€¢ <strong>UI Layer</strong>: 8ê°œ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ (MainWindow 2,382ì¤„)<br>
                    â€¢ <strong>Services</strong>: 8ê°œ í•µì‹¬ ì„œë¹„ìŠ¤ (Top3, ProjectTag, Analysis, LLM)<br>
                    â€¢ <strong>NLP</strong>: 4ê°œ ë¶„ì„ ëª¨ë“ˆ (ìš”ì•½, ìš°ì„ ìˆœìœ„, TODO ì¶”ì¶œ, ê·¸ë£¹í™”)<br>
                    â€¢ <strong>Database</strong>: 3ê°œ SQLite DB (TODO, í”„ë¡œì íŠ¸ íƒœê·¸, Top3 ìºì‹œ)
                </p>
            </div>
        </div>
        
        <!-- ë°ì´í„° í”Œë¡œìš° -->
        <div id="dataflow" class="diagram-container">
            <div class="diagram-title">4. ë°ì´í„° í”Œë¡œìš° (ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨)</div>
            <div class="diagram-description">
                ì‚¬ìš©ìê°€ í˜ë¥´ì†Œë‚˜ë¥¼ ì„ íƒí•œ í›„ TODOê°€ ìƒì„±ë˜ê³  Top3ê°€ ì„ ì •ë˜ê¸°ê¹Œì§€ì˜ ì „ì²´ íë¦„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            </div>
            <div class="mermaid">
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant GUI as PyQt6 GUI
    participant DSM as Data Source Manager
    participant VDOS as VirtualOffice API
    participant AP as Analysis Pipeline
    participant LLM as GPT-4o
    participant PTS as Project Tag Service
    participant T3S as Top3 Service
    participant DB as SQLite Cache
    
    User->>GUI: í˜ë¥´ì†Œë‚˜ ì„ íƒ (ì´ì •ë‘)
    GUI->>DSM: ë°ì´í„° ìˆ˜ì§‘ ìš”ì²­
    DSM->>VDOS: GET /api/emails?since_id=6895
    VDOS-->>DSM: ì´ë©”ì¼ 10ê°œ
    DSM->>VDOS: GET /api/messages?since_id=3529
    VDOS-->>DSM: ë©”ì‹œì§€ 15ê°œ
    
    DSM->>AP: ë©”ì‹œì§€ 25ê°œ ë¶„ì„ ìš”ì²­
    AP->>LLM: ë©”ì‹œì§€ ìš”ì•½ ìƒì„±
    LLM-->>AP: ìš”ì•½ í…ìŠ¤íŠ¸
    AP->>LLM: TODO ì¶”ì¶œ
    LLM-->>AP: TODO 5ê°œ
    
    AP->>PTS: í”„ë¡œì íŠ¸ íƒœê·¸ ë¶„ë¥˜
    PTS->>LLM: "API ë¦¬íŒ©í† ë§" ë¶„ì„
    LLM-->>PTS: HA í”„ë¡œì íŠ¸
    PTS->>DB: íƒœê·¸ ì €ì¥
    
    AP->>T3S: Top3 ì„ ì • (ìì—°ì–´ ê·œì¹™)
    T3S->>LLM: "ê¹€ì—°ì¤‘ + HA" ê·œì¹™ ì ìš©
    LLM-->>T3S: TODO 3ê°œ ì„ ì •
    T3S->>DB: ê²°ê³¼ ìºì‹œ (TTL 5ë¶„)
    
    DB-->>GUI: TODO 207ê°œ + Top3
    GUI-->>User: UI ì—…ë°ì´íŠ¸
            </div>
            <div class="info-box">
                <h3>ğŸ’¡ ì²˜ë¦¬ íë¦„</h3>
                <p>
                    1. <strong>ë°ì´í„° ìˆ˜ì§‘</strong>: VirtualOffice APIì—ì„œ ì¦ë¶„ ìˆ˜ì§‘ (since_id ê¸°ë°˜)<br>
                    2. <strong>ë¶„ì„</strong>: LLMìœ¼ë¡œ ë©”ì‹œì§€ ìš”ì•½ ë° TODO ì¶”ì¶œ<br>
                    3. <strong>ë¶„ë¥˜</strong>: í”„ë¡œì íŠ¸ íƒœê·¸ ìë™ ë¶„ë¥˜ (LLM ê¸°ë°˜)<br>
                    4. <strong>ì„ ì •</strong>: ìì—°ì–´ ê·œì¹™ìœ¼ë¡œ Top3 ì„ ì • (LLM + ìºì‹œ)<br>
                    5. <strong>í‘œì‹œ</strong>: UI ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„)
                </p>
            </div>
        </div>
    </div>
    
    <script>
        function showDiagram(id) {
            // ëª¨ë“  íƒ­ê³¼ ë‹¤ì´ì–´ê·¸ë¨ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.diagram-container').forEach(container => container.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ë‹¤ì´ì–´ê·¸ë¨ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
