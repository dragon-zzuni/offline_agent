# TODO 리스트 생성 원리

## 개요

Smart Assistant는 이메일과 메신저 메시지를 분석하여 자동으로 TODO 리스트를 생성합니다. 이 문서에서는 실제 데이터를 기반으로 TODO가 어떻게 생성되는지, 그리고 왜 어떤 메시지는 TODO로 변환되지 않는지 설명합니다.

## TODO 생성 프로세스

### 1단계: 메시지 수집
- **이메일**: VDOS DB에서 수신한 이메일 조회
- **채팅**: VDOS DB에서 수신한 채팅 메시지 조회
- **필터링**: 현재 선택된 페르소나가 **수신한** 메시지만 수집

### 2단계: 우선순위 분류 (Priority Ranking)
모든 메시지를 3단계로 분류:
- **HIGH**: 즉시 처리 필요 (긴급, 중요)
- **MEDIUM**: 일반 업무
- **LOW**: 참고용 정보

**분류 기준**:
```python
# nlp/priority_ranker.py
HIGH 키워드: ["긴급", "urgent", "asap", "즉시", "빨리", "deadline", "마감"]
MEDIUM 키워드: ["요청", "부탁", "확인", "검토", "회신", "답변"]
LOW: 위 키워드가 없는 일반 메시지
```

### 3단계: 상위 메시지 상세 분석 (LLM)
- **우선순위 HIGH/MEDIUM 상위 70개** 메시지만 LLM으로 상세 분석
- Azure OpenAI GPT-4o 사용
- 각 메시지에서 추출:
  - 요약 (summary)
  - 핵심 포인트 (key_points)
  - 필요한 액션 (action_required)
  - 감정 (sentiment)
  - 긴급도 (urgency)

### 4단계: TODO 추출 (Action Extraction)
LLM 분석 결과에서 `action_required: true`인 메시지만 TODO로 변환:

**TODO 타입 분류**:
- **meeting**: 미팅, 회의 일정
- **task**: 작업, 업무 처리
- **deadline**: 마감 기한이 있는 작업
- **review**: 검토, 확인 요청
- **response**: 답변, 회신 필요

### 5단계: TODO 저장
- SQLite DB에 저장 (`todos_cache.db`)
- 프로젝트 태그 자동 분류 (비동기)
- Top-3 점수 계산

---

## 실제 예시 1: TODO로 생성되는 경우 (HIGH 우선순위)

### 원본 메시지
```
발신자: serin.kim@company.com
제목: [Project VERTEX] 디자인 초안 검토 요청
내용: 
정지원님 안녕하세요,

Project VERTEX의 디자인 초안을 첨부합니다.
내일(11/8) 오전까지 검토 후 피드백 부탁드립니다.

주요 확인 사항:
1. 전체적인 레이아웃 구성
2. 색상 조합
3. 사용자 경험 흐름

감사합니다.
김세린 드림
```

### 처리 과정

#### 1단계: 우선순위 분류
```python
# priority_ranker.py 실행
키워드 매칭:
- "검토" → MEDIUM
- "요청" → MEDIUM
- "내일" → HIGH (시간 제약)
- "까지" → HIGH (마감 기한)

최종 우선순위: HIGH ✅
```

#### 2단계: LLM 분석
```json
{
  "summary": "Project VERTEX 디자인 초안 검토 요청",
  "key_points": [
    "디자인 초안 첨부됨",
    "내일 오전까지 검토 필요",
    "레이아웃, 색상, UX 확인 필요"
  ],
  "action_required": true,  ✅
  "sentiment": "neutral",
  "urgency": "high",
  "deadline": "2025-11-08T10:00:00+00:00"
}
```

#### 3단계: TODO 생성
```python
# action_extractor.py 실행
TODO 타입 판단:
- "검토" 키워드 → review
- "내일 오전까지" → deadline 포함

생성된 TODO:
{
  "id": "review_abc123",
  "type": "review",
  "title": "[Project VERTEX] 디자인 초안 검토",
  "description": "레이아웃, 색상, UX 확인",
  "priority": "high",
  "deadline": "2025-11-08T10:00:00+00:00",
  "requester": "serin.kim@company.com",
  "project": "PV",  # 비동기로 분류됨
  "status": "pending"
}
```

#### 결과
✅ **TODO 리스트에 표시됨**
- 우선순위: HIGH (빨간색)
- 프로젝트 태그: PV (Project VERTEX)
- 마감일: 내일 오전
- Top-3 후보 가능

---

## 실제 예시 2: TODO로 생성되지 않는 경우 (이메일 탭에만 표시)

### 원본 메시지
```
발신자: hongyu.im@company.com
제목: 프로젝트 진행 업데이트
내용:
정지원님 안녕하세요,

현재 집중 작업:
안녕하세요, 임호규입니다.
오늘의 업무 계획을 다음과 같이 조정하였습니다.

1. 팀 미팅 (09:00-10:00)
   - Project NEXUS 진행 상황 점검
   - 아이디어 회의 결과 공유

2. 개발 작업 (10:00-12:00)
   - 데이터 파이프라인 구축
   - API 연동 테스트

3. 점심 시간 (12:00-13:00)

오늘도 좋은 하루 되세요!
임호규 드림
```

### 처리 과정

#### 1단계: 우선순위 분류
```python
# priority_ranker.py 실행
키워드 매칭:
- "업데이트" → 일반 정보
- "진행 상황" → 보고성 메시지
- 긴급/요청 키워드 없음

최종 우선순위: LOW ⚠️
```

#### 2단계: LLM 분석 (상위 70개에 포함되지 않음)
```
❌ LOW 우선순위는 상세 분석 대상에서 제외됨
→ LLM 분석 없이 기본 정보만 저장
```

#### 3단계: TODO 생성 시도
```python
# action_extractor.py 실행
action_required 확인:
- LLM 분석 결과 없음
- 기본 패턴 매칭:
  - "요청", "부탁", "확인" 등 액션 키워드 없음
  - 단순 정보 공유 메시지로 판단

action_required: false ❌
```

#### 결과
❌ **TODO 리스트에 표시되지 않음**
✅ **이메일 탭에만 표시됨**
- 우선순위: LOW
- 분석 결과: "팀원의 업무 계획 공유"
- 액션 불필요: 참고용 정보

---

## TODO 생성 조건 요약

### ✅ TODO로 생성되는 조건
1. **우선순위 HIGH 또는 MEDIUM**
2. **LLM 분석 결과 `action_required: true`**
3. **다음 중 하나 이상 포함**:
   - 명확한 요청 ("~해주세요", "~부탁드립니다")
   - 마감 기한 ("~까지", "내일", "이번 주")
   - 액션 키워드 ("검토", "확인", "답변", "회신", "참석")
   - 질문 ("~인가요?", "~해도 될까요?")

### ❌ TODO로 생성되지 않는 경우
1. **우선순위 LOW** (상세 분석 제외)
2. **단순 정보 공유** (보고, 업데이트, 공지)
3. **액션 불필요** (참고용, FYI)
4. **이미 완료된 작업** (과거 시제)
5. **자동 알림** (시스템 메시지)

---

## 우선순위별 처리 흐름

```
┌─────────────────┐
│  메시지 수집    │
│  (이메일+채팅)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 우선순위 분류   │
│ (키워드 기반)   │
└────┬────┬───┬───┘
     │    │   │
  HIGH  MED LOW
     │    │   │
     ▼    ▼   ▼
┌─────────────┐  ┌──────────┐
│ LLM 상세분석│  │ 기본정보 │
│ (상위 70개) │  │ 저장만   │
└──────┬──────┘  └────┬─────┘
       │              │
       ▼              ▼
┌─────────────┐  ┌──────────┐
│ TODO 추출   │  │ 이메일탭 │
│ (액션 필요) │  │ 표시만   │
└──────┬──────┘  └──────────┘
       │
       ▼
┌─────────────┐
│ TODO 리스트 │
│ 표시        │
└─────────────┘
```

---

## 실제 통계 (이정두 페르소나 기준)

### 메시지 수집
- 총 메시지: 11,115개 (이메일 3,891개 + 채팅 7,224개)

### 우선순위 분류
- HIGH: ~500개 (4.5%)
- MEDIUM: ~3,000개 (27%)
- LOW: ~7,615개 (68.5%)

### LLM 상세 분석
- 분석 대상: 상위 70개 (HIGH/MEDIUM 중)
- 분석 시간: ~30초

### TODO 생성
- 생성된 TODO: 219개 (전체의 2%)
- action_required: true 비율: ~31% (70개 중 22개)

### 결과
- **TODO 리스트**: 219개 (액션 필요)
- **이메일 탭**: 10,896개 (참고용 + TODO)

---

## 개선 방향

### 현재 한계
1. **LOW 우선순위 메시지는 상세 분석 안 됨**
   - 중요한 메시지가 LOW로 분류되면 TODO 누락 가능
   
2. **키워드 기반 우선순위 분류의 한계**
   - 문맥을 고려하지 않음
   - 오분류 가능성

### 개선 방안
1. **2단계 분석**:
   - 1차: 키워드 기반 빠른 분류
   - 2차: LOW 중 일부도 LLM으로 재검증

2. **학습 기반 분류**:
   - 사용자 피드백 수집
   - 분류 모델 개선

3. **컨텍스트 고려**:
   - 이전 대화 맥락 분석
   - 프로젝트별 중요도 가중치
