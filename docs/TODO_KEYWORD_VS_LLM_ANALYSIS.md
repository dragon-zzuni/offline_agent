# TODO 생성: 키워드 필터링 vs LLM 판단 비교

## 개요

이 문서는 **동일한 키워드("검토")**를 포함하지만, **LLM 판단에 따라 하나는 TODO가 되고 하나는 안 된 실제 사례**를 분석합니다.

---

## 실제 사례 비교

### 📋 공통점: 둘 다 "검토" 키워드 포함

| 항목 | 사례 A (TODO 생성 ✅) | 사례 B (TODO 생성 ❌) |
|------|---------------------|---------------------|
| **이메일 ID** | email_9462 | email_14897 |
| **발신자** | jungjiwon@koreaitcompany.com | doyoonlee@companyexample.com |
| **수신자** | 이정두 (leejungdu@example.com) | 이정두 (leejungdu@example.com) |
| **제목** | [Project LUMINA] 디자인 초안 제출 안내 | 이정두님께 업데이트 드립니다 |
| **키워드** | "검토" ✅ | "검토" ✅ |

---

## 사례 A: TODO 생성 ✅

### 원본 이메일
```
발신자: jungjiwon@koreaitcompany.com
제목: [Project LUMINA] 디자인 초안 제출 안내
내용:
오늘 팀 미팅에서 논의한 디자인 초안을 정리하여 제출할 예정입니다. 
피드백 회의 전에 검토해 주시기 바랍니다. 
의견 주시면 감사하겠습니다.
```

### 1단계: 키워드 필터링 (우선순위 분류)

#### 키워드 매칭
```python
# priority_ranker.py: _calculate_keyword_score()

HIGH 키워드:
- "미팅" → 1개 매칭 ✅
- "회의" → 0개

MEDIUM 키워드:
- "검토" → 1개 매칭 ✅
- "피드백" → 1개 매칭 ✅
- "의견" → 1개 매칭 ✅

키워드 점수 = min(1.0, 1 * 0.6 + 3 * 0.3) = 1.0
```

#### 우선순위 점수 계산
```python
overall_score = (
    0.1 * 0.30 +  # 긴급도: 0.1 ("오늘" 1개)
    0.6 * 0.25 +  # 발신자: 0.6 (회사 도메인)
    1.0 * 0.20 +  # 키워드: 1.0 ✅ ("미팅", "검토", "피드백", "의견")
    0.3 * 0.15 +  # 데드라인: 0.3 ("전에" 1개)
    0.7 * 0.10    # 중요도: 0.7 ("미팅", "피드백")
)

overall_score = 0.03 + 0.15 + 0.20 + 0.045 + 0.07 = 0.495

최종 우선순위: MEDIUM (0.495점) ✅
→ 상위 70개 포함 가능
```

### 2단계: LLM 상세 분석

#### LLM 프롬프트
```
발신자: jungjiwon@koreaitcompany.com
제목: [Project LUMINA] 디자인 초안 제출 안내
내용: 오늘 팀 미팅에서 논의한 디자인 초안을 정리하여 제출할 예정입니다. 
피드백 회의 전에 검토해 주시기 바랍니다. 
의견 주시면 감사하겠습니다.
```

#### LLM 응답
```json
{
  "summary": "디자인 초안 검토 및 피드백 요청",
  "key_points": [
    "디자인 초안 제출 예정",
    "피드백 회의 전 검토 필요",
    "의견 요청"
  ],
  "action_required": true,  ✅
  "sentiment": "neutral",
  "urgency": "medium",
  "deadline": null
}
```

#### LLM 판단 근거 (action_required = true)

**1. 명확한 요청 표현**
```
"검토해 주시기 바랍니다" → 직접적인 요청 ✅
"의견 주시면 감사하겠습니다" → 명확한 액션 요구 ✅
```

**2. 수신자 중심 문장**
```
주어: (수신자가) 암묵적 주어
동사: "검토해 주시기", "의견 주시면"
→ 수신자가 해야 할 행동 명시 ✅
```

**3. 시간 제약**
```
"피드백 회의 전에" → 명확한 시간 제약 ✅
→ 긴급성 부여
```

**4. 구체적인 액션**
```
1. 디자인 초안 검토
2. 피드백 제공
3. 의견 제시
→ 3가지 구체적 액션 ✅
```

**5. 요청 강도**
```
"~해 주시기 바랍니다" → 강한 요청 (should do)
"의견 주시면 감사하겠습니다" → 기대 표현
→ 필수 액션으로 판단 ✅
```

### 3단계: TODO 생성

```python
# action_extractor.py: extract_actions()

키워드 매칭:
- "검토" → review 타입 ✅
- "피드백" → review 타입 ✅
- "미팅" → meeting 타입 ✅

생성된 TODO (4개):
1. review_2a5711bce6c9: "문서검토"
2. meeting_98b13622eed1: "미팅참석"
3. task_162605677056: "업무처리"
4. deadline_b73b5cc6c36c: "마감작업"
```

### 결과: ✅ TODO 리스트에 표시

---

## 사례 B: TODO 생성 안 됨 ❌

### 원본 이메일
```
발신자: doyoonlee@companyexample.com
제목: 이정두님께 업데이트 드립니다
내용:
이정두님 안녕하세요,

현재 집중 작업:
안녕하세요, 이도윤입니다.
오늘의 주요 목표와 일정을 아래와 같이 계획했습니다.
1. 광고 캠페인 성과 검토 및 데이터 분석
   - 최근 캠페인의 성과를 분석하고 개선점을 도출합니다.

요청: 안녕하세요, 이도윤입니다.
필요하시면 언제든 말씀해 주세요.
```

### 1단계: 키워드 필터링 (우선순위 분류)

#### 키워드 매칭
```python
# priority_ranker.py: _calculate_keyword_score()

HIGH 키워드:
- "미팅" → 0개
- "회의" → 0개

MEDIUM 키워드:
- "검토" → 1개 매칭 ✅
- "update" → 1개 매칭 ✅ (제목)
- "요청" → 1개 매칭 ✅

키워드 점수 = min(1.0, 0 * 0.6 + 3 * 0.3) = 0.9
```

#### 우선순위 점수 계산
```python
overall_score = (
    0.1 * 0.30 +  # 긴급도: 0.1 ("오늘" 1개)
    0.6 * 0.25 +  # 발신자: 0.6 (회사 도메인)
    0.9 * 0.20 +  # 키워드: 0.9 ✅ ("검토", "update", "요청")
    0.0 * 0.15 +  # 데드라인: 0.0
    0.4 * 0.10    # 중요도: 0.4 ("캠페인", "분석")
)

overall_score = 0.03 + 0.15 + 0.18 + 0.00 + 0.04 = 0.40

최종 우선순위: MEDIUM (0.40점) ✅
→ 상위 70개 포함 가능 (경계선)
```

### 2단계: LLM 상세 분석

#### LLM 프롬프트
```
발신자: doyoonlee@companyexample.com
제목: 이정두님께 업데이트 드립니다
내용: 이정두님 안녕하세요,

현재 집중 작업:
안녕하세요, 이도윤입니다.
오늘의 주요 목표와 일정을 아래와 같이 계획했습니다.
1. 광고 캠페인 성과 검토 및 데이터 분석
   - 최근 캠페인의 성과를 분석하고 개선점을 도출합니다.

요청: 안녕하세요, 이도윤입니다.
필요하시면 언제든 말씀해 주세요.
```

#### LLM 응답
```json
{
  "summary": "이도윤의 오늘 업무 계획 공유",
  "key_points": [
    "광고 캠페인 성과 검토 예정 (발신자 본인 작업)",
    "데이터 분석 및 개선점 도출 예정",
    "조건부 지원 제안"
  ],
  "action_required": false,  ❌
  "sentiment": "neutral",
  "urgency": "low",
  "deadline": null
}
```

#### LLM 판단 근거 (action_required = false)

**1. 주체가 발신자 본인**
```
"안녕하세요, 이도윤입니다" → 발신자 자기소개 ❌
"오늘의 주요 목표와 일정을 계획했습니다" → 발신자 본인 계획 ❌
"광고 캠페인 성과 검토" → 발신자가 할 일 ❌
```

**2. 과거/완료 시제**
```
"계획했습니다" → 이미 계획 완료 ❌
"도출합니다" → 발신자가 할 행동 ❌
```

**3. 조건부 요청**
```
"필요하시면 언제든 말씀해 주세요" → 조건부 제안 ❌
→ "필요하시면" = 선택적
→ 필수 액션 아님
```

**4. 정보 공유 목적**
```
제목: "업데이트 드립니다" → 정보 전달 ❌
내용: "현재 집중 작업" → 상태 보고 ❌
→ 수신자 액션 불필요
```

**5. 요청 강도**
```
"필요하시면" → 약한 제안 (may do) ❌
"언제든" → 시간 제약 없음 ❌
→ 선택적 액션으로 판단
```

### 3단계: TODO 생성 시도

```python
# action_extractor.py: extract_actions()

LLM 분석 결과:
- action_required = false ❌

키워드 매칭 시도:
- "검토" 키워드 있음 ✅
- BUT 문맥 분석:
  - "광고 캠페인 성과 검토" → 발신자가 할 일
  - 수신자에게 요청하는 내용 없음

TODO 생성: ❌ 생성 안 됨
```

### 결과: ❌ 이메일 탭에만 표시

---

## 핵심 차이점 상세 분석

### 1. 키워드 필터링 단계 (1차)

| 항목 | 사례 A (TODO ✅) | 사례 B (TODO ❌) |
|------|-----------------|-----------------|
| **"검토" 키워드** | ✅ 있음 | ✅ 있음 |
| **키워드 점수** | 1.0 | 0.9 |
| **우선순위 점수** | 0.495 (MEDIUM) | 0.40 (MEDIUM) |
| **상위 70개 포함** | ✅ YES | ✅ YES (경계선) |
| **1차 필터 통과** | ✅ 통과 | ✅ 통과 |

**→ 둘 다 키워드 필터링 통과! 동일한 출발점**

### 2. LLM 판단 단계 (2차)

| 항목 | 사례 A (TODO ✅) | 사례 B (TODO ❌) |
|------|-----------------|-----------------|
| **문장 주체** | 수신자 (암묵적) | 발신자 본인 |
| **요청 표현** | "검토해 주시기 바랍니다" | "필요하시면 말씀해 주세요" |
| **요청 강도** | 강함 (should do) | 약함 (may do) |
| **시제** | 미래 (제출 예정) | 과거 (계획했습니다) |
| **시간 제약** | "회의 전에" | 없음 ("언제든") |
| **구체적 액션** | 3가지 (검토, 피드백, 의견) | 0가지 (조건부 제안만) |
| **action_required** | **true** ✅ | **false** ❌ |

**→ LLM 판단에서 명확한 차이 발생!**

### 3. 문장 구조 비교

#### 사례 A (TODO ✅): 수신자 중심 문장
```
"피드백 회의 전에 검토해 주시기 바랍니다"
│                    │
│                    └─ 수신자가 해야 할 행동
└─ 시간 제약

구조: [시간 제약] + [수신자 액션] + [강한 요청]
→ 명확한 TODO 항목
```

#### 사례 B (TODO ❌): 발신자 중심 문장
```
"광고 캠페인 성과 검토 및 데이터 분석"
│                  │
│                  └─ 발신자가 할 일
└─ 발신자의 계획

구조: [발신자 주어] + [발신자 액션] + [조건부 제안]
→ 정보 공유 목적
```

### 4. 요청 표현 비교

#### 사례 A (TODO ✅): 명확한 요청
```
"검토해 주시기 바랍니다" → 직접 요청 ✅
"의견 주시면 감사하겠습니다" → 기대 표현 ✅

패턴: [동사] + [주시기 바랍니다]
→ 한국어 정중한 명령형
→ 필수 액션으로 해석
```

#### 사례 B (TODO ❌): 조건부 제안
```
"필요하시면 언제든 말씀해 주세요" → 조건부 제안 ❌

패턴: [필요하시면] + [언제든] + [말씀해 주세요]
→ 조건부 + 시간 제약 없음
→ 선택적 액션으로 해석
```

---

## 프로세스 흐름 비교

### 사례 A (TODO ✅)
```
1. 키워드 필터링
   "검토" 키워드 → ✅ 통과
   우선순위: MEDIUM (0.495)
   
2. LLM 분석 (상위 70개 포함)
   문장 주체: 수신자
   요청 표현: "검토해 주시기 바랍니다"
   → action_required = true ✅
   
3. TODO 생성
   타입: review
   제목: "문서검토"
   우선순위: high
   → ✅ TODO 리스트에 표시
```

### 사례 B (TODO ❌)
```
1. 키워드 필터링
   "검토" 키워드 → ✅ 통과
   우선순위: MEDIUM (0.40)
   
2. LLM 분석 (상위 70개 포함)
   문장 주체: 발신자 본인
   요청 표현: "필요하시면 말씀해 주세요"
   → action_required = false ❌
   
3. TODO 생성 시도
   LLM 판단: 액션 불필요
   → ❌ TODO 생성 안 됨
   → ❌ 이메일 탭에만 표시
```

---

## 결론

### 키워드 필터링의 한계
```
"검토" 키워드만으로는 TODO 여부를 판단할 수 없음

사례 A: "검토해 주시기 바랍니다" → TODO ✅
사례 B: "광고 캠페인 성과 검토" → TODO ❌

→ 동일한 키워드, 다른 문맥
→ LLM 판단 필수
```

### LLM 판단의 중요성
```
LLM은 다음을 종합적으로 분석:
1. 문장 주체 (수신자 vs 발신자)
2. 요청 표현 (명확 vs 조건부)
3. 요청 강도 (필수 vs 선택)
4. 시제 (미래 vs 과거)
5. 시간 제약 (있음 vs 없음)

→ 문맥 기반 정확한 판단
→ 키워드 필터링의 한계 극복
```

### 2단계 필터링의 효과
```
1단계 (키워드): 빠른 우선순위 분류
   - 11,115개 → 상위 70개 선정
   - 비용 효율: 159배 절감

2단계 (LLM): 정확한 액션 판단
   - 상위 70개 → 22개 TODO 생성
   - 정확도: 문맥 기반 판단

결과:
- 비용 효율 ✅
- 정확도 향상 ✅
- 오탐 최소화 ✅
```

---

## 실용적 가이드

### TODO로 만들고 싶다면?

**사례 B를 TODO로 변경하려면:**

```
변경 전 (TODO 안 됨 ❌):
"오늘의 주요 목표와 일정을 계획했습니다.
1. 광고 캠페인 성과 검토 및 데이터 분석
필요하시면 언제든 말씀해 주세요."

변경 후 (TODO 생성 ✅):
"광고 캠페인 성과 검토를 진행 중입니다.
이정두님의 의견이 필요합니다.
내일 오전까지 검토 후 피드백 부탁드립니다."

변경 포인트:
1. 주체 변경: "계획했습니다" → "의견이 필요합니다"
2. 요청 명확화: "필요하시면" → "피드백 부탁드립니다"
3. 시간 제약 추가: "언제든" → "내일 오전까지"
```

### 키워드만으로 판단하지 말 것

```
❌ 잘못된 판단:
"검토" 키워드 있음 → 무조건 TODO

✅ 올바른 판단:
"검토" 키워드 있음 → LLM 분석 필요
→ 문맥 확인 → action_required 판단
```
