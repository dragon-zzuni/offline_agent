# 🎯 Smart Assistant - 핵심 기능 상세 가이드

## 목차
1. [REST API 통한 실시간 연동](#1-rest-api-통한-실시간-연동)
2. [메시지/메일 통합 분석 및 TODO 리스트 정리](#2-메시지메일-통합-분석-및-todo-리스트-정리)
3. [Top3 TODO 사용자 맞춤 필터링](#3-top3-todo-사용자-맞춤-필터링)
4. [메시지 내역 요약](#4-메시지-내역-요약)
5. [일정 마무리 시스템](#5-일정-마무리-시스템)

---

## 1. REST API 통한 실시간 연동

### 개요
VirtualOffice 시뮬레이션과 실시간으로 데이터를 동기화하여 최신 메시지를 자동으로 수집합니다.

### 주요 기능
- **자동 폴링**: 30초 간격으로 신규 메시지 확인
- **증분 수집**: `since_id` 기반으로 새 데이터만 가져옴
- **비동기 처리**: UI 블로킹 없이 백그라운드 실행
- **에러 복구**: API 실패 시 자동 재시도

### 사용 방법
1. GUI 실행 후 **데이터 소스** → **VirtualOffice 연동** 선택
2. 페르소나 선택 (예: 이정두)
3. **자동 폴링 시작** 버튼 클릭
4. 30초마다 자동으로 신규 메시지 수집 및 분석

### 기술 스택
- `VirtualOfficeCoordinator`: 연동 조정
- `PollingWorker`: APScheduler 기반 자동 폴링
- `VirtualOfficeSource`: REST API 클라이언트

### 성능
- 초기 수집: ~1초 (156개 이메일)
- 증분 수집: ~200ms (10개 신규 메시지)
- 메모리: ~50MB

---

## 2. 메시지/메일 통합 분석 및 TODO 리스트 정리

### 개요
이메일과 메신저를 통합 분석하여 자동으로 TODO를 생성하고 프로젝트별로 분류합니다.

### 주요 기능
- **통합 분석**: 이메일 + 메신저 동시 처리
- **자동 TODO 생성**: LLM 기반 액션 아이템 추출
- **프로젝트 자동 분류**: 3단계 분류 로직
- **우선순위 계산**: 마감일, 발신자, 키워드 기반

### 프로젝트 분류 로직
```
1단계: 명시적 패턴 매칭 (100% 정확도)
  - "[HA]", "HealthCore" → HA 프로젝트
  
2단계: LLM 내용 분석 (90% 정확도)
  - VDOS DB 프로젝트 정보 참조
  - 메시지 내용 기반 분류
  
3단계: 발신자 기반 폴백 (80% 정확도)
  - 발신자의 주 프로젝트로 분류
```

### 프로젝트 태그 예시
- **HA**: HealthCore API 리팩토링
- **CC**: Care Connect 2.0 리디자인
- **WELL**: WellLink 브랜드 런칭
- **WI**: WellLink Insight Dashboard
- **CI**: CareBridge Integration

### 기술 스택
- `AnalysisPipelineService`: 분석 파이프라인
- `MessageSummarizer`: LLM 기반 요약
- `ActionExtractor`: TODO 추출
- `PriorityRanker`: 우선순위 계산
- `ProjectTagService`: 프로젝트 분류

### 성능
- TODO 추출: ~2초 (100개 메시지)
- 프로젝트 분류: ~1초 (LLM 호출 포함)
- 캐시 히트율: 80%+

---

## 3. Top3 TODO 사용자 맞춤 필터링

### 개요
자연어 규칙으로 가장 중요한 TODO 3개를 자동 선정합니다.

### 주요 기능
- **자연어 규칙**: 코딩 없이 규칙 작성
- **LLM RAG 방식**: TODO DB 전체를 컨텍스트로 참조
- **사전 필터링**: 207개 → 50개 (규칙 관련 TODO 우선)
- **캐싱**: TTL 5분, 동일 규칙 재사용 시 즉시 응답
- **폴백**: LLM 실패 시 점수 기반 선정

### 자연어 규칙 예시
```
"김연중이 요청자이고 HA 프로젝트면 우선순위 높게"
"마감일이 오늘이고 우선순위가 high인 TODO"
"전형우가 보낸 메일에서 추출된 TODO"
"WellLink 프로젝트 중 우선순위 medium 이상"
```

### 트러블슈팅 진화 과정

#### 시도 1: 순수 LLM 문맥 파악
- **방식**: LLM이 규칙과 TODO 제목만 비교
- **문제**: 긴 제목 처리 약함, 느림 (10초)
- **정확도**: 60%

#### 시도 2: LLM 키워드 추출 + 휴리스틱
- **방식**: LLM이 키워드 추출 → 문자열 매칭
- **문제**: 오매칭 발생 (같은 키워드, 다른 프로젝트)
- **정확도**: 75%

#### 최종: LLM + RAG (TODO DB 참조) ✅
- **방식**: LLM이 전체 TODO 컨텍스트 참조하여 선정
- **장점**: 프로젝트, 요청자, 설명 모두 고려
- **정확도**: 95%

### 기술 스택
- `Top3Service`: 선정 오케스트레이션
- `Top3LLMSelector`: LLM 기반 선정
- `Top3CacheManager`: TTL 캐시
- `Top3ScoreCalculator`: 점수 기반 폴백

### 성능
- 캐시 히트: <50ms (90% 히트율)
- 캐시 미스: ~2.5초 (LLM 호출 포함)
- 토큰 소비: ~1,500 토큰/호출
- 비용: ~$0.02/호출

---

## 4. 메시지 내역 요약

### 개요
시간대별/발신자별로 메시지를 그룹화하여 요약을 제공합니다.

### 주요 기능
- **시간대별 그룹화**: 3시간 단위 (09:00-12:00, 12:00-15:00, ...)
- **발신자별 서브그룹**: 사람별로 메시지 정리
- **LLM 요약**: 긴 메시지도 1-2문장으로 압축
- **빠른 탐색**: 시간대 클릭으로 상세 내용 확인

### 사용 방법
1. **Time Range Selector**에서 기간 선택
   - 오늘, 어제, 최근 7일, 최근 30일, 커스텀
2. **Message Summary Panel**에서 그룹별 요약 확인
3. 그룹 클릭 시 상세 메시지 표시

### UI 표시 예시
```
📅 2025-11-03 (오늘)

🕐 09:00 - 12:00
  👤 김연중 (5개 메시지)
     "HealthCore API 리팩토링 진행 상황 공유. 
      테스트 커버리지 80% 달성. 
      다음 주 배포 예정."
  
  👤 전형우 (3개 메시지)
     "WellLink 디자인 시안 검토 요청. 
      피드백 금요일까지 부탁드립니다."

🕐 12:00 - 15:00
  👤 황다연 (2개 메시지)
     "CareConnect 회의 일정 조율. 
      목요일 오후 2시 가능하신가요?"
```

### 기술 스택
- `TimeRangeSelector`: 날짜 범위 선택 UI
- `MessageGrouping`: 시간/발신자 그룹화
- `GroupedSummary`: 그룹 요약 생성
- `MessageSummaryPanel`: UI 표시

### 성능
- 그룹화: ~100ms (100개 메시지)
- 요약 생성: ~2초 (10개 그룹)
- 메모리: ~20MB

---

## 5. 일정 마무리 시스템

### 개요
하루/주간 업무를 요약하고 날씨 정보를 제공합니다.

### 주요 기능
- **일일 요약**: 오늘 완료/진행 중 TODO, 주요 메시지
- **주간 요약**: 이번 주 통계, 프로젝트별 진행 상황
- **날씨 정보**: 내일 날씨 미리 확인
- **복사 기능**: 요약 내용 클립보드 복사

### 일일 요약 내용
```
📅 2025년 11월 3일 (월요일) 업무 요약

🌤️ 날씨: 맑음, 18°C (서울)

✅ 완료한 TODO (5개)
  1. [HA] API 문서 작성 완료
  2. [CC] 디자인 시안 검토
  3. [WELL] 마케팅 자료 준비
  4. [WI] 대시보드 버그 수정
  5. [CI] 통합 테스트 실행

🔄 진행 중인 TODO (3개)
  1. [HA] 리팩토링 코드 리뷰 (마감: 11/5)
  2. [CC] 환자 관리 기능 개발 (마감: 11/7)
  3. [WELL] 브랜드 가이드 작성 (마감: 11/10)

📊 주요 활동
  - 이메일: 25개 수신, 12개 발송
  - 메시지: 18개 대화
  - 회의: 2건 (HA 리뷰, CC 기획)

💬 주요 메시지
  - 김연중: "HealthCore API 리팩토링 80% 완료"
  - 전형우: "WellLink 디자인 최종 승인"
  - 황다연: "CareConnect 회의 일정 확정"

🎯 내일 할 일 (Top3)
  1. [HA] 리팩토링 코드 리뷰 완료
  2. [CC] 환자 관리 기능 개발 시작
  3. [WELL] 브랜드 가이드 초안 작성
```

### 주간 요약 내용
```
📅 2025년 11월 1주차 (11/1 ~ 11/7) 업무 요약

📈 주간 통계
  - 완료 TODO: 23개
  - 진행 중 TODO: 8개
  - 신규 TODO: 15개
  - 이메일: 156개
  - 메시지: 89개

🏆 프로젝트별 진행 상황
  [HA] HealthCore API 리팩토링: 80% 완료
    - API 문서 작성 완료
    - 테스트 커버리지 80% 달성
    - 다음 주 배포 예정
  
  [CC] Care Connect 2.0: 60% 완료
    - 디자인 시안 최종 승인
    - 환자 관리 기능 개발 중
    - 11월 말 베타 출시 목표
  
  [WELL] WellLink 브랜드 런칭: 40% 완료
    - 마케팅 자료 준비 완료
    - 브랜드 가이드 작성 중
    - 12월 초 런칭 예정

🎯 다음 주 목표
  1. HealthCore API 배포 완료
  2. CareConnect 환자 관리 기능 완성
  3. WellLink 브랜드 가이드 최종 검토
```

### 기술 스택
- `SummaryDialog`: 요약 다이얼로그 UI
- `DailySummary`: 일일 요약 생성
- `WeeklySummary`: 주간 요약 생성
- `WeatherService`: 날씨 API 연동

### 성능
- 일일 요약: ~3초 (LLM 호출 포함)
- 주간 요약: ~5초 (LLM 호출 포함)
- 날씨 조회: ~500ms (API 호출)

---

## 📊 핵심 기능별 성능 비교

| 기능 | 처리 시간 | 정확도 | 토큰 소비 | 비용 |
|------|----------|--------|-----------|------|
| **1. REST API 연동** | 200ms | N/A | 0 | 무료 |
| **2. TODO 생성** | 2초 | 90% | 500 | $0.01 |
| **3. Top3 선정** | 2.5초 | 95% | 1,500 | $0.02 |
| **4. 메시지 요약** | 2초 | N/A | 800 | $0.015 |
| **5. 일정 마무리** | 3초 | N/A | 1,000 | $0.02 |

**일일 총 비용**: ~$0.10 (100개 메시지 기준)  
**월간 총 비용**: ~$3.00

---

## 🎨 아키텍처 다이어그램

핵심 기능 아키텍처를 시각적으로 확인하려면 다음 파일을 참조하세요:

- **HTML 뷰어**: [docs/diagrams/viewer.html](diagrams/viewer.html)
- **Mermaid 파일**: [docs/diagrams/core_features_architecture.mmd](diagrams/core_features_architecture.mmd)

브라우저에서 `viewer.html`을 열면 인터랙티브 다이어그램을 확인할 수 있습니다.

---

## 📚 관련 문서

- [ARCHITECTURE_PRESENTATION.md](../ARCHITECTURE_PRESENTATION.md): 전체 아키텍처 문서
- [TOP3_RAG_GUIDE.md](TOP3_RAG_GUIDE.md): Top3 LLM 구현 가이드
- [REALTIME_AUTO_ANALYSIS.md](REALTIME_AUTO_ANALYSIS.md): 실시간 분석 가이드
- [VDOS_MIGRATION.md](VDOS_MIGRATION.md): VirtualOffice 연동 가이드

---

**작성일**: 2025-11-03  
**버전**: v1.4.0  
**작성자**: Smart Assistant Team
